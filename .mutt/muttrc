source ~/.mutt/accounts/$MAIL_ACCOUNT

set realname              = "Alex Pilon"
set sort                  = threads
set sort_aux              = reverse-last-date-received

set certificate_file      = ~/.mutt/certificates
set mailcap_path          = ~/.mutt/mailcap
set header_cache          = ~/.mutt/cache
#set history_file          = ~/.mutt/history
#set save_history

# Don't need to leak what I run
set user_agent = no

# Not modifying files in mail dir except with Maildir-aware programs
set maildir_header_cache_verify = no

#auto_view text/calendar
auto_view text/html # view html automatically
auto_view application/msword
alternative_order text/plain text/enriched text/html # save html for last
bind attach <return> view-mailcap

# Not bound to generic, because we want to *override* some bindings, whereas
# generic is a fallback.
bind pager j next-line
bind pager k previous-line
bind pager G bottom
bind pager g top
# Should only delete the message you can currently see in the pager.
bind pager d delete-message
# Mutt doesn't have modes or motions like Vi or Vim, so we emulate.
bind index dd delete-message
bind index dt delete-subthread
bind index dp delete-thread  # p for parent, in a sense
bind index uu undelete-message
bind index ut undelete-subthread
bind index up undelete-thread
bind index H top-page
bind index M middle-page
bind index L bottom-page
bind index G last-entry
bind index g first-entry
bind pager,index ? search-reverse
bind pager,index \Cf next-page
bind pager,index \Cb previous-page
bind pager,index \Cd half-down
bind pager,index \Cu half-up
bind pager,index \Ce next-line
bind pager,index \Cy previous-line
bind pager,index rr reply
bind pager,index rg group-reply
bind pager,index rl list-reply
bind pager,index ]t next-thread
bind pager,index [t previous-thread
bind pager,index ]p next-thread
bind pager,index [p parent-message


set alias_file = ~/.mutt/aliases
source $alias_file

source 'if [ $(tput colors) = 256 ]; then \
            cat ~/.mutt/color/solarized-dark-256; \
        fi |'

set ignore_list_reply_to

source /etc/Muttrc.gpg.dist

# Above is a generic script from upstream. Override **here**, not there.
set pgp_use_gpg_agent        = yes
set crypt_autosign           = yes
set crypt_autoencrypt        = no
set crypt_replysign          = yes
set crypt_replyencrypt       = yes
set crypt_replysignencrypted = yes
set crypt_use_gpgme          = yes
set pgp_ignore_subkeys       = no

unset markers
# TODO: set crypto-hook for people for which PGP key choice is ambiguous, or
#       otherwise fix using GnuPG?
set help = no
#set status_on_top = yes
set forward_quote = yes
set forward_format = "Fwd: %s"
#set header = yes  # TODO: Figure out how to start in E, not e
set edit_headers = yes
set tilde = yes  # less emulation
#set thorough_search = yes  # Sometimes want to percent-decode
#set pager = "vim -R"
#set prompt_after = no
set pager_stop
set mbox_type             = Maildir
set confirmappend = no
set confirmcreate = no
# When creating a new message only. we do want to interactively
# prompt for the recipients and subject, because it's annoying to
# unfold the headers in Vim.
set fast_reply
#set autoedit
set hide_missing = yes  # want to see what it looks like
set print = no
set reverse_alias
set strict_threads = yes  # e.g., Subhect: Co-op report, joined both GENBAND and LiveQoS one

set abort_unmodified = no

# TODO: client-side spam filtering.
# TODO: bind imap-fetch-mail
# TODO: exec collapse-all; set sort_aux = reverse-data, so
#       that the last message in a thread is the one shown on
#       the crease. Make macro so that unfold also sets old
#       sort_aux.
# TODO: Get used to \t (complete—on aliases)
#       ^T (complete-query) in editor menu
# TODO: Under isync, make $ or something like that fetch
#       and/or push changes to server. May want to make some
#       of these unidirectional for the sake of speed. mbsync
#       should support that.
# TODO: Change folder bindings à la vim tpope-unimpaired
# TODO: Make S (skip-quoted) a habit, esp. on fucking
#       full-quoters on Metzdowd.
# TODO: Source some scrypt-encrypted keychain?
# TODO: my_hdr X-Message-Flag: Look, you're rude and making other email
#                              users' out there's life hard. I'm not
#                              apologizing for your email client messing up
#                              formatting.
# TODO: set tmpdir="~/.mutt/tmp" so as to not lose drafts during a crash?
# TODO: set hidden_host or unset use_domain on kanataserver?
# TODO: lower imap_keepalive for cmail?
# TODO: Iff mailcap file is generic, move to home instead and
#       unset mailcap_path?
# TODO: unset mark_old?
# TODO: set message_cachedir in .mutt accounts?
# TODO: set message_cache_clean
# TODO: set narrow_tree?
# TODO: set sig for business correspondence
# TODO: set simple_search to include other headers?
# TODO: imap_passive + message_cachedir + macro for lazy online mode?
# TODO: online-offline mode macros
# TODO: cert pinning, preferrably automatic
# TODO: See if ssl_force_tls is incompatible with STARTTLS
# TODO: set strict_threads
# TODO: Look into flowed text
# TODO: tunnel for accounts with SSH access
# TODO: bind <Ctrl>-f in editor mode to visual or something
# TODO: See if wait_key=no still works with mailcap needsterminal
# TODO: unset bounce_delivered because I use postfix?
# TODO: Remove In-Reply-To header from the user-editables
# TODO: http://shallowsky.com/blog/linux/mutt-fwd-attachments.html
# TODO: Remove remaining forwarding decorations.
# TODO: More Vim bindings.
# TODO: Some sort of partial thread collapsing?
# TODO: Redo last command, using some cheap macro and variable trick, if
#       possible
# TODO: Figure out how to make forwarded messages not include header
